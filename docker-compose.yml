version: '3.8'

services:
  # ---------------------------------------------------------------------------
  # Database Service (SQL Server)
  # ---------------------------------------------------------------------------
  db:
    image: mcr.microsoft.com/mssql/server:2022-latest
    container_name: sql_server_container
    environment:
      - ACCEPT_EULA=Y
      - MSSQL_SA_PASSWORD=SqlPass@123
    ports:
      - "1433:1433"
    volumes:
      - sql_data:/var/opt/mssql/data
    networks:
      - app-network

  # ---------------------------------------------------------------------------
  # Backend Service (Flask API)
  # ---------------------------------------------------------------------------
  flask-api:
    build: ./PythonFlaskAPIBackend
    container_name: flask_backend_container
    ports:
      - "5000:5000"
    environment:
      - DB_SERVER=db
      - DB_NAME=flask-demo
      - DB_USER=sa
      - DB_PASSWORD=SqlPass@123
      - ODBC_DRIVER=ODBC Driver 17 for SQL Server
      - SECRET_KEY=dev_secret_key
    depends_on:
      - db
    networks:
      - app-network

  # ---------------------------------------------------------------------------
  # Frontend Service (Angular + Nginx)
  # ---------------------------------------------------------------------------
  frontend:
    build: ./AngularFrontend
    container_name: angular_frontend_container
    ports:
      - "4200:4200"
    depends_on:
      - flask-api
    networks:
      - app-network

networks:
  app-network:
    driver: bridge

volumes:
  sql_data:
